<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>a3e4fd21d38541d481a2ef9ebc12a14b</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div class="cell markdown" id="uEkAvvmIdpd_">
<h1>DELE CA1 Part A</h1>
<h2>Name         : Isaac low zu le</h2>
<h2>class        : DAAA/FT/2A/03</h2>
<h2>admin number : P2342348</h2>
</div>
<div class="cell code" id="s0nxMxsS6Sf2">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
<div class="cell markdown" id="ZkKs4UIbXXCC">
<h2>Firstly, i will conduct Data visualisation</h2>
<h4>we will see what makes up our dataset so that we will have more information on how to proceed with training the model.</h4>
</div>
<div class="cell code" data-execution_count="1" id="ZdgCuDboexvJ">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Larger CNN Model</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dense</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dropout</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Flatten</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Conv2D</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> MaxPooling2D</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.utils <span class="im">import</span> to_categorical</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.losses <span class="im">import</span> sparse_categorical_crossentropy</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.preprocessing.image <span class="im">import</span> ImageDataGenerator</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.callbacks <span class="im">import</span> EarlyStopping</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2" id="ZQ2Hr9zjt65w">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_images_from_folder_37(folder):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    images <span class="op">=</span> []</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> []</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> label, subfolder <span class="kw">in</span> <span class="bu">enumerate</span>(os.listdir(folder)):</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        path <span class="op">=</span> os.path.join(folder, subfolder)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> os.path.isdir(path):</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> filename <span class="kw">in</span> os.listdir(path):</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                img_path <span class="op">=</span> os.path.join(path, filename)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                image <span class="op">=</span> cv2.imread(img_path)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> image <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Resize the image to 37x37 pixels</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                    image <span class="op">=</span> cv2.resize(image, (<span class="dv">37</span>, <span class="dv">37</span>))</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Convert the image to grayscale</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                    image <span class="op">=</span> cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                    images.append(image)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>                    labels.append(subfolder)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(images), np.array(labels)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_images_from_folder_131(folder):</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    images <span class="op">=</span> []</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> []</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> label, subfolder <span class="kw">in</span> <span class="bu">enumerate</span>(os.listdir(folder)):</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        path <span class="op">=</span> os.path.join(folder, subfolder)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> os.path.isdir(path):</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> filename <span class="kw">in</span> os.listdir(path):</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>                img_path <span class="op">=</span> os.path.join(path, filename)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>                image <span class="op">=</span> cv2.imread(img_path)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> image <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Resize the image to 37x37 pixels</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>                    image <span class="op">=</span> cv2.resize(image, (<span class="dv">131</span>, <span class="dv">131</span>))</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Convert the image to grayscale</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>                    image <span class="op">=</span> cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>                    images.append(image)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>                    labels.append(subfolder)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(images), np.array(labels)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="3"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="0s_YQWRiYs-P" data-outputId="d66a6cf9-6c94-4c6a-fb21-3e193f37889f">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>X_train_37,y_train_37<span class="op">=</span>load_images_from_folder_37(<span class="st">&quot;/content/drive/MyDrive/Dataset for CA1 part A - AY2425S1/train&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>X_test_37,y_test_37<span class="op">=</span>load_images_from_folder_37(<span class="st">&quot;/content/drive/MyDrive/Dataset for CA1 part A - AY2425S1/test&quot;</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>X_val_37,y_val_37<span class="op">=</span>load_images_from_folder_37(<span class="st">&quot;/content/drive/MyDrive/Dataset for CA1 part A - AY2425S1/validation&quot;</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train_37.shape)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_37.shape)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val_37.shape)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_val_37.shape)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>(9048, 37, 37)
(9048,)
(3000, 37, 37)
(3000,)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="4"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="pzHtrnSBYrhU" data-outputId="eae8e014-96c0-4ded-eabd-3f553dc01a97">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>X_train_131, y_train_131 <span class="op">=</span> load_images_from_folder_131(<span class="st">&quot;/content/drive/MyDrive/Dataset for CA1 part A - AY2425S1/train&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>X_test_131, y_test_131 <span class="op">=</span> load_images_from_folder_131(<span class="st">&quot;/content/drive/MyDrive/Dataset for CA1 part A - AY2425S1/test&quot;</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>X_val_131, y_val_131 <span class="op">=</span> load_images_from_folder_131(<span class="st">&quot;/content/drive/MyDrive/Dataset for CA1 part A - AY2425S1/validation&quot;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train_131.shape)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_131.shape)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val_131.shape)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_val_131.shape)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>(9048, 131, 131)
(9048,)
(3000, 131, 131)
(3000,)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="5"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
id="4OT1bXuEEsTA" data-outputId="1e5fa869-4c38-46cc-c888-f9b52d861d18">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> display_images_by_class(images, labels, plot_title, num_rows<span class="op">=</span><span class="dv">3</span>, num_cols<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    unique_labels <span class="op">=</span> np.unique(labels)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(num_rows, num_cols, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span>))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(plot_title, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, ax <span class="kw">in</span> <span class="bu">enumerate</span>(axes.flat):</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(unique_labels):</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>            label <span class="op">=</span> unique_labels[i]</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            label_indices <span class="op">=</span> np.where(labels <span class="op">==</span> label)[<span class="dv">0</span>]</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(label_indices) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>                image_index <span class="op">=</span> label_indices[<span class="dv">0</span>]</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                ax.imshow(images[image_index], cmap<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                ax.set_title(label)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        ax.axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>display_images_by_class(X_train_37, y_train_37,<span class="st">&quot;train&quot;</span>, num_rows<span class="op">=</span><span class="dv">3</span>, num_cols<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>display_images_by_class(X_test_37, y_test_37,<span class="st">&quot;test&quot;</span>, num_rows<span class="op">=</span><span class="dv">3</span>, num_cols<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>display_images_by_class(X_val_37, y_val_37,<span class="st">&quot;validation&quot;</span>, num_rows<span class="op">=</span><span class="dv">3</span>, num_cols<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/8fc88256d2f983419bf477552d30376b02655b09.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/15fd855cfd2cebc238d002dc0ea8cea1df8bdcbe.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/0e01dc288bb8d52fa8d73da2aaaf489db81639c5.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="6"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
id="NhNwbY3LUsjf" data-outputId="61d38621-62c2-4995-db4d-e5066529d6e9">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>display_images_by_class(X_train_131, y_train_131, <span class="st">&quot;train&quot;</span>, num_rows<span class="op">=</span><span class="dv">3</span>, num_cols<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>display_images_by_class(X_test_131, y_test_131, <span class="st">&quot;test&quot;</span>, num_rows<span class="op">=</span><span class="dv">3</span>, num_cols<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>display_images_by_class(X_val_131, y_val_131, <span class="st">&quot;validation&quot;</span>, num_rows<span class="op">=</span><span class="dv">3</span>, num_cols<span class="op">=</span><span class="dv">3</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/b19d2226d0ff18e5188c06e08dd74185ebb436df.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/c2a6bcd6d4adfb66de3afa38955d3e17822383fe.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/ff25568cfdb400b9e039a3a02638298717dca6c4.png" /></p>
</div>
</div>
<div class="cell markdown" id="3TARwkJAoG4j">
<h4>here, we can see that the images in the dataset have been converted to greyscale, and have also been resized to 37x37 and 131x131</h4>
</div>
<div class="cell code" data-execution_count="7"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:757}"
id="6eIqH6lypg0V" data-outputId="d2018a49-218a-4077-aac1-22de17d73e91">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>unique_classes <span class="op">=</span> np.unique(y_train_37)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>label_to_index <span class="op">=</span> {label: i <span class="cf">for</span> i, label <span class="kw">in</span> <span class="bu">enumerate</span>(unique_classes)}</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>y_train_numeric <span class="op">=</span> np.array([label_to_index[label] <span class="cf">for</span> label <span class="kw">in</span> y_train_37])</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>class_counts <span class="op">=</span> np.bincount(y_train_numeric)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>class_percentages <span class="op">=</span> (class_counts <span class="op">/</span> <span class="bu">len</span>(y_train_numeric)) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>plt.pie(class_percentages, labels<span class="op">=</span>unique_classes, autopct<span class="op">=</span><span class="st">&#39;</span><span class="sc">%1.1f%%</span><span class="st">&#39;</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Percentage of Each Class in the Dataset&#39;</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&#39;equal&#39;</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train_37.shape)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_37.shape)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val_37.shape)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_val_37.shape)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/930a450d6cdbf87261a7dcca5f65ca6f5302c3b8.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>(9048, 37, 37)
(9048,)
(3000, 37, 37)
(3000,)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="7" id="zLUCD7CXP4gv">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
<div class="cell markdown" id="9edQBWeqA5jK">
<p>here, we can see that the distribution of different veggie types is
not equal, maybe we cout augment the images later on to make the dataset
more balanced</p>
</div>
<div class="cell code" data-execution_count="8"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:682}"
id="tnJPd83j8fin" data-outputId="353208d4-2ead-4fec-e4f0-765dacb9d26b">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>unique_classes <span class="op">=</span> np.unique(y_val_37)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>label_to_index <span class="op">=</span> {label: i <span class="cf">for</span> i, label <span class="kw">in</span> <span class="bu">enumerate</span>(unique_classes)}</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>y_val_numeric <span class="op">=</span> np.array([label_to_index[label] <span class="cf">for</span> label <span class="kw">in</span> y_val_37])</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>class_counts <span class="op">=</span> np.bincount(y_val_numeric)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>class_percentages <span class="op">=</span> (class_counts <span class="op">/</span> <span class="bu">len</span>(y_val_numeric)) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>plt.pie(class_percentages, labels<span class="op">=</span>unique_classes, autopct<span class="op">=</span><span class="st">&#39;</span><span class="sc">%1.1f%%</span><span class="st">&#39;</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Percentage of Each Class in the Dataset&#39;</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&#39;equal&#39;</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/5961a1c87dd9e02d1405b7014ff95ef68368d2c3.png" /></p>
</div>
</div>
<div class="cell markdown" id="ZtazzA_Or4K6">
<p>for the validation set its equal so that is good.</p>
</div>
<div class="cell code" data-execution_count="9"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="qlkbyx8j-2ap" data-outputId="157ebb86-ecca-4327-f7af-5807f6022f13">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val_37.shape[<span class="dv">0</span>])</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output stream stdout">
<pre><code>3000
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="10"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="_4ufN6JYeXm2" data-outputId="bd74631b-2797-47d0-ed29-ed01a160d68a">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train_37.shape)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_37.shape)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val_37.shape)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_val_37.shape)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output stream stdout">
<pre><code>(9048, 37, 37)
(9048,)
(3000, 37, 37)
(3000,)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="11"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="opHo_wDjcawa" data-outputId="31d16394-69e3-47f1-966d-0b6f02d17f42">
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train_131.shape)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_131.shape)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val_131.shape)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_val_131.shape)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>(9048, 131, 131)
(9048,)
(3000, 131, 131)
(3000,)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="12" id="Qf0sYTE9uqpZ">
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># implement early stopping</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>earlyStopping <span class="op">=</span> EarlyStopping(monitor<span class="op">=</span><span class="st">&quot;val_loss&quot;</span>, patience<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fix random seed for reproducibility</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.set_random_seed(<span class="dv">42</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocess_data(X_train, y_train, X_val, y_val):</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># one hot encode outputs</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    num_classes <span class="op">=</span> <span class="bu">len</span>(np.unique(np.concatenate((y_train, y_val))))</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y_train.reshape(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    y_val <span class="op">=</span> y_val.reshape(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    label_encoder <span class="op">=</span> LabelEncoder()</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> label_encoder.fit_transform(y_train)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    y_val <span class="op">=</span> label_encoder.transform(y_val)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> to_categorical(y_train, num_classes)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    y_val <span class="op">=</span> to_categorical(y_val, num_classes)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    num_classes <span class="op">=</span> y_val.shape[<span class="dv">1</span>]</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X_train, y_train, X_val, y_val, num_classes</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocess X_train_37, y_train_37, X_val_37, y_val_37</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>X_train_37, y_train_37, X_val_37, y_val_37, num_classes_37 <span class="op">=</span> preprocess_data(X_train_37, y_train_37, X_val_37, y_val_37)</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>X_train_131, y_train_131, X_val_131, y_val_131, num_classes_131 <span class="op">=</span> preprocess_data(X_train_131, y_train_131, X_val_131, y_val_131)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>num_classes <span class="op">=</span> y_val_37.shape[<span class="dv">1</span>]</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>input_shape_37 <span class="op">=</span> (<span class="dv">37</span>,<span class="dv">37</span>,<span class="dv">1</span>)</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>input_shape_131 <span class="op">=</span> (<span class="dv">131</span>,<span class="dv">131</span>,<span class="dv">1</span>)</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="co"># build the model</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> Sequential</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span> Conv2D, MaxPooling2D, Dropout, Flatten, Dense</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_cnn_model(input_shape, num_classes):</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Sequential()</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(<span class="dv">32</span>, (<span class="dv">3</span>, <span class="dv">3</span>), input_shape<span class="op">=</span>input_shape, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>))</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    model.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(<span class="dv">64</span>, (<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>))</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>    model.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(<span class="dv">64</span>, (<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>))</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>    model.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>    model.add(Flatten())</span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>    model.add(Dense(<span class="dv">128</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>))</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>    model.add(Dense(num_classes, activation<span class="op">=</span><span class="st">&#39;softmax&#39;</span>))</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">&#39;categorical_crossentropy&#39;</span>,</span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>                  optimizer<span class="op">=</span><span class="st">&#39;adam&#39;</span>,</span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>                  metrics<span class="op">=</span>[<span class="st">&#39;accuracy&#39;</span>])</span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_accuracy_loss(history):</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the accuracy</span></span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>    plt.plot(history.history[<span class="st">&#39;accuracy&#39;</span>])</span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>    plt.plot(history.history[<span class="st">&#39;val_accuracy&#39;</span>])</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">&#39;Model Accuracy&#39;</span>)</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&#39;Accuracy&#39;</span>)</span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">&#39;Epoch&#39;</span>)</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>    plt.legend([<span class="st">&#39;Train&#39;</span>, <span class="st">&#39;Validation&#39;</span>], loc<span class="op">=</span><span class="st">&#39;upper left&#39;</span>)</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the loss</span></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>    plt.plot(history.history[<span class="st">&#39;loss&#39;</span>])</span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>    plt.plot(history.history[<span class="st">&#39;val_loss&#39;</span>])</span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">&#39;Model Loss&#39;</span>)</span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&#39;Loss&#39;</span>)</span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">&#39;Epoch&#39;</span>)</span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>    plt.legend([<span class="st">&#39;Train&#39;</span>, <span class="st">&#39;Validation&#39;</span>], loc<span class="op">=</span><span class="st">&#39;upper left&#39;</span>)</span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="14" id="dMrzkFx9cznQ">
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train_backup_37 = X_train_37</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># y_train_backup_37 = y_train_37</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># X_val_backup_37 = X_val_37</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># y_val_backup_37 = y_val_37</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>X_train_37 <span class="op">=</span> X_train_backup_37</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>y_train_37 <span class="op">=</span> y_train_backup_37</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>X_val_37 <span class="op">=</span> X_val_backup_37</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>y_val_37 <span class="op">=</span> y_val_backup_37</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="15"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
id="rQI3e22eYL81" data-outputId="7f412f95-51da-4157-d81e-02be4a365d4e">
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.set_random_seed(<span class="dv">42</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>create_cnn_model(input_shape_37,num_classes)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(X_train_37, y_train_37, validation_data<span class="op">=</span>(X_val_37, y_val_37),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a> epochs<span class="op">=</span><span class="dv">100</span>, batch_size<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">1</span>,callbacks<span class="op">=</span>[earlyStopping])</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Final evaluation of the model</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> model.evaluate(X_val_37, y_val_37, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;CNN Error: </span><span class="sc">%.2f%%</span><span class="st">&quot;</span> <span class="op">%</span> (<span class="dv">100</span><span class="op">-</span>scores[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>plot_accuracy_loss(history)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
91/91 [==============================] - 4s 30ms/step - loss: 3.2349 - accuracy: 0.1495 - val_loss: 2.4622 - val_accuracy: 0.1940
Epoch 2/100
91/91 [==============================] - 2s 20ms/step - loss: 2.1214 - accuracy: 0.3069 - val_loss: 2.1353 - val_accuracy: 0.3147
Epoch 3/100
91/91 [==============================] - 2s 21ms/step - loss: 1.8043 - accuracy: 0.4141 - val_loss: 1.9058 - val_accuracy: 0.3690
Epoch 4/100
91/91 [==============================] - 2s 21ms/step - loss: 1.5498 - accuracy: 0.4972 - val_loss: 1.6872 - val_accuracy: 0.4607
Epoch 5/100
91/91 [==============================] - 2s 20ms/step - loss: 1.3586 - accuracy: 0.5538 - val_loss: 1.5263 - val_accuracy: 0.5170
Epoch 6/100
91/91 [==============================] - 2s 22ms/step - loss: 1.1775 - accuracy: 0.6187 - val_loss: 1.4599 - val_accuracy: 0.5297
Epoch 7/100
91/91 [==============================] - 2s 21ms/step - loss: 1.0259 - accuracy: 0.6641 - val_loss: 1.3419 - val_accuracy: 0.5623
Epoch 8/100
91/91 [==============================] - 2s 20ms/step - loss: 0.8742 - accuracy: 0.7196 - val_loss: 1.2848 - val_accuracy: 0.6003
Epoch 9/100
91/91 [==============================] - 2s 20ms/step - loss: 0.7640 - accuracy: 0.7578 - val_loss: 1.2412 - val_accuracy: 0.6187
Epoch 10/100
91/91 [==============================] - 2s 21ms/step - loss: 0.6504 - accuracy: 0.7908 - val_loss: 1.2908 - val_accuracy: 0.6130
Epoch 11/100
91/91 [==============================] - 2s 19ms/step - loss: 0.5862 - accuracy: 0.8106 - val_loss: 1.2423 - val_accuracy: 0.6360
Epoch 12/100
91/91 [==============================] - 2s 21ms/step - loss: 0.5299 - accuracy: 0.8258 - val_loss: 1.1226 - val_accuracy: 0.6690
Epoch 13/100
91/91 [==============================] - 2s 19ms/step - loss: 0.4260 - accuracy: 0.8652 - val_loss: 1.2097 - val_accuracy: 0.6693
Epoch 14/100
91/91 [==============================] - 2s 19ms/step - loss: 0.4058 - accuracy: 0.8708 - val_loss: 1.1325 - val_accuracy: 0.6850
Epoch 15/100
91/91 [==============================] - 2s 22ms/step - loss: 0.3642 - accuracy: 0.8844 - val_loss: 1.2186 - val_accuracy: 0.6740
Epoch 16/100
91/91 [==============================] - 2s 20ms/step - loss: 0.3311 - accuracy: 0.8925 - val_loss: 1.2773 - val_accuracy: 0.6847
Epoch 17/100
91/91 [==============================] - 2s 20ms/step - loss: 0.3242 - accuracy: 0.8946 - val_loss: 1.1450 - val_accuracy: 0.7003
CNN Error: 29.97%
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/75014fa786ef0c2632d8647e11fb28e2f62031ae.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="16"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:917}"
id="O6CdtI5ZYULZ" data-outputId="cbe4f80b-d0df-471f-de80-37b8a9ff4b9f">
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.set_random_seed(<span class="dv">42</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> create_cnn_model(input_shape_131, num_classes)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(X_train_131, y_train_131, validation_data<span class="op">=</span>(X_val_131, y_val_131),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                    epochs<span class="op">=</span><span class="dv">100</span>, batch_size<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>[earlyStopping])</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Final evaluation of the model</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> model.evaluate(X_val_131, y_val_131, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;CNN Error: </span><span class="sc">%.2f%%</span><span class="st">&quot;</span> <span class="op">%</span> (<span class="dv">100</span><span class="op">-</span>scores[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>plot_accuracy_loss(history)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
91/91 [==============================] - 29s 307ms/step - loss: 4.6329 - accuracy: 0.2646 - val_loss: 2.1188 - val_accuracy: 0.3410
Epoch 2/100
91/91 [==============================] - 28s 304ms/step - loss: 1.5087 - accuracy: 0.5338 - val_loss: 1.7005 - val_accuracy: 0.4940
Epoch 3/100
91/91 [==============================] - 27s 299ms/step - loss: 0.8815 - accuracy: 0.7281 - val_loss: 1.4080 - val_accuracy: 0.6133
Epoch 4/100
91/91 [==============================] - 27s 301ms/step - loss: 0.4892 - accuracy: 0.8489 - val_loss: 1.6892 - val_accuracy: 0.6067
Epoch 5/100
91/91 [==============================] - 27s 298ms/step - loss: 0.3046 - accuracy: 0.9113 - val_loss: 1.7471 - val_accuracy: 0.6543
Epoch 6/100
91/91 [==============================] - 27s 299ms/step - loss: 0.1836 - accuracy: 0.9486 - val_loss: 2.4004 - val_accuracy: 0.6007
Epoch 7/100
91/91 [==============================] - 27s 299ms/step - loss: 0.1422 - accuracy: 0.9615 - val_loss: 2.4374 - val_accuracy: 0.6417
Epoch 8/100
91/91 [==============================] - 27s 299ms/step - loss: 0.1123 - accuracy: 0.9682 - val_loss: 2.7943 - val_accuracy: 0.6197
CNN Error: 38.03%
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/173bddfe2c300a813b0d0656b1b4ff9272827dee.png" /></p>
</div>
</div>
<div class="cell markdown" id="NyzwwtlBgn4w">
<p>results: <br> on (37x37)=val_loss: 1.1450 - val_accuracy: 0.7003 <br>
on 131x131=val_loss: 2.7943 - val_accuracy: 0.6197</p>
</div>
<div class="cell markdown" id="gtVkXZRsqXmD">
<p>first step, i will be removing anomalous data from the dataset. from
reviewing the data, i have found data that are in the wrong folders,
such as immages of carrots in the bean dataset, and also copies of the
same image in the bean dataset. i have removed the anomalies and put
them in a seperate folder, named rejected. now i will load it as the X
and y.</p>
</div>
<div class="cell code" data-execution_count="17" id="QcqoAU11qREH">
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>X_train_37,y_train_37<span class="op">=</span>load_images_from_folder_37(<span class="st">&quot;/content/drive/MyDrive/Dataset for CA1 part A - cleaned/train&quot;</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># X_test_37,y_test_37=load_images_from_folder_37(&quot;/content/drive/MyDrive/Dataset for CA1 part A - cleaned/test&quot;)</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>X_val_37,y_val_37<span class="op">=</span>load_images_from_folder_37(<span class="st">&quot;/content/drive/MyDrive/Dataset for CA1 part A - cleaned/validation&quot;</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="18" id="KQu4fTFDX7BU">
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>X_train_131, y_train_131 <span class="op">=</span> load_images_from_folder_131(<span class="st">&quot;/content/drive/MyDrive/Dataset for CA1 part A - cleaned/train&quot;</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># X_test_131, y_test_131 = load_images_from_folder_131(&quot;/content/drive/MyDrive/Dataset for CA1 part A - cleaned/test&quot;)</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>X_val_131, y_val_131 <span class="op">=</span> load_images_from_folder_131(<span class="st">&quot;/content/drive/MyDrive/Dataset for CA1 part A - cleaned/validation&quot;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="19" id="z814LJsexrxQ">
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>X_train_backup_37 <span class="op">=</span> X_train_37</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>y_train_backup_37 <span class="op">=</span> y_train_37</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>X_val_backup_37 <span class="op">=</span> X_val_37</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>y_val_backup_37 <span class="op">=</span> y_val_37</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train_37 = X_train_backup_37</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># y_train_37 = y_train_backup_37</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># X_val_37 = X_val_backup_37</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># y_val_37 = y_val_backup_37</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="20" id="mA1BYTeRZNDz">
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>X_train_backup_131 <span class="op">=</span> X_train_131</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>y_train_backup_131 <span class="op">=</span> y_train_131</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>X_val_backup_131 <span class="op">=</span> X_val_131</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>y_val_backup_131 <span class="op">=</span> y_val_131</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train_131 = X_train_backup_131</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># y_train_131 = y_train_backup_131</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># X_val_131 = X_val_backup_131</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># y_val_131 = y_val_backup_131</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="21"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
id="NuJAYrDlacH3" data-outputId="e649043f-3f9e-486e-bc0f-99f26e27fa83">
<div class="sourceCode" id="cb30"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># fix random seed for reproducibility</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.set_random_seed(<span class="dv">42</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>X_train_37, y_train_37, X_val_37, y_val_37, num_classes_37 <span class="op">=</span> preprocess_data(X_train_37, y_train_37, X_val_37, y_val_37)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> create_cnn_model(input_shape_37, num_classes)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(X_train_37, y_train_37, validation_data<span class="op">=</span>(X_val_37, y_val_37),</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>                    epochs<span class="op">=</span><span class="dv">100</span>, batch_size<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>[earlyStopping])</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Final evaluation of the model</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> model.evaluate(X_val_37, y_val_37, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;CNN Error: </span><span class="sc">%.2f%%</span><span class="st">&quot;</span> <span class="op">%</span> (<span class="dv">100</span><span class="op">-</span>scores[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>plot_accuracy_loss(history)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
91/91 [==============================] - 3s 21ms/step - loss: 3.3169 - accuracy: 0.1437 - val_loss: 2.4974 - val_accuracy: 0.1850
Epoch 2/100
91/91 [==============================] - 2s 20ms/step - loss: 2.1768 - accuracy: 0.2825 - val_loss: 2.1884 - val_accuracy: 0.2887
Epoch 3/100
91/91 [==============================] - 2s 21ms/step - loss: 1.8727 - accuracy: 0.3951 - val_loss: 2.3062 - val_accuracy: 0.2997
Epoch 4/100
91/91 [==============================] - 2s 19ms/step - loss: 1.6583 - accuracy: 0.4637 - val_loss: 1.7383 - val_accuracy: 0.4280
Epoch 5/100
91/91 [==============================] - 2s 18ms/step - loss: 1.4394 - accuracy: 0.5300 - val_loss: 1.6364 - val_accuracy: 0.4763
Epoch 6/100
91/91 [==============================] - 2s 18ms/step - loss: 1.2487 - accuracy: 0.5961 - val_loss: 1.6798 - val_accuracy: 0.4747
Epoch 7/100
91/91 [==============================] - 2s 19ms/step - loss: 1.0990 - accuracy: 0.6431 - val_loss: 1.3495 - val_accuracy: 0.5720
Epoch 8/100
91/91 [==============================] - 2s 18ms/step - loss: 0.9159 - accuracy: 0.7023 - val_loss: 1.3053 - val_accuracy: 0.5963
Epoch 9/100
91/91 [==============================] - 2s 18ms/step - loss: 0.8013 - accuracy: 0.7427 - val_loss: 1.2112 - val_accuracy: 0.6217
Epoch 10/100
91/91 [==============================] - 2s 19ms/step - loss: 0.7441 - accuracy: 0.7550 - val_loss: 1.2613 - val_accuracy: 0.6337
Epoch 11/100
91/91 [==============================] - 2s 18ms/step - loss: 0.6336 - accuracy: 0.7997 - val_loss: 1.4041 - val_accuracy: 0.5983
Epoch 12/100
91/91 [==============================] - 2s 18ms/step - loss: 0.5300 - accuracy: 0.8278 - val_loss: 1.2714 - val_accuracy: 0.6440
Epoch 13/100
91/91 [==============================] - 2s 17ms/step - loss: 0.4976 - accuracy: 0.8435 - val_loss: 1.2027 - val_accuracy: 0.6640
Epoch 14/100
91/91 [==============================] - 2s 17ms/step - loss: 0.4032 - accuracy: 0.8735 - val_loss: 1.2697 - val_accuracy: 0.6590
Epoch 15/100
91/91 [==============================] - 2s 17ms/step - loss: 0.3537 - accuracy: 0.8892 - val_loss: 1.2637 - val_accuracy: 0.6767
Epoch 16/100
91/91 [==============================] - 2s 18ms/step - loss: 0.3353 - accuracy: 0.8938 - val_loss: 1.2541 - val_accuracy: 0.6773
Epoch 17/100
91/91 [==============================] - 2s 20ms/step - loss: 0.2666 - accuracy: 0.9177 - val_loss: 1.2659 - val_accuracy: 0.6890
Epoch 18/100
91/91 [==============================] - 2s 20ms/step - loss: 0.2346 - accuracy: 0.9273 - val_loss: 1.2753 - val_accuracy: 0.6970
CNN Error: 30.30%
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/0d6f3b70ad1f21a83d61d347aab3fff1770c7546.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="22"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:917}"
id="4E50eNc2gNS3" data-outputId="db0df93d-6c6f-4de4-9cda-965d0da357dd">
<div class="sourceCode" id="cb32"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># fix random seed for reproducibility</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.set_random_seed(<span class="dv">42</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>X_train_131, y_train_131, X_val_131, y_val_131, num_classes_131 <span class="op">=</span> preprocess_data(X_train_131, y_train_131, X_val_131, y_val_131)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> create_cnn_model(input_shape_131, num_classes)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(X_train_131, y_train_131, validation_data<span class="op">=</span>(X_val_131, y_val_131),</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>                    epochs<span class="op">=</span><span class="dv">100</span>, batch_size<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>[earlyStopping])</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Final evaluation of the model</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> model.evaluate(X_val_131, y_val_131, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;CNN Error: </span><span class="sc">%.2f%%</span><span class="st">&quot;</span> <span class="op">%</span> (<span class="dv">100</span><span class="op">-</span>scores[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>plot_accuracy_loss(history)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
91/91 [==============================] - 28s 302ms/step - loss: 4.0787 - accuracy: 0.2833 - val_loss: 1.8961 - val_accuracy: 0.4050
Epoch 2/100
91/91 [==============================] - 27s 298ms/step - loss: 1.3782 - accuracy: 0.5784 - val_loss: 1.5403 - val_accuracy: 0.5457
Epoch 3/100
91/91 [==============================] - 27s 298ms/step - loss: 0.7435 - accuracy: 0.7727 - val_loss: 1.2831 - val_accuracy: 0.6427
Epoch 4/100
91/91 [==============================] - 27s 302ms/step - loss: 0.3801 - accuracy: 0.8859 - val_loss: 1.4736 - val_accuracy: 0.6527
Epoch 5/100
91/91 [==============================] - 28s 304ms/step - loss: 0.2549 - accuracy: 0.9218 - val_loss: 1.6862 - val_accuracy: 0.6647
Epoch 6/100
91/91 [==============================] - 27s 301ms/step - loss: 0.1383 - accuracy: 0.9609 - val_loss: 1.7396 - val_accuracy: 0.6820
Epoch 7/100
91/91 [==============================] - 27s 301ms/step - loss: 0.1083 - accuracy: 0.9687 - val_loss: 1.9369 - val_accuracy: 0.6513
Epoch 8/100
91/91 [==============================] - 27s 300ms/step - loss: 0.0845 - accuracy: 0.9782 - val_loss: 1.9097 - val_accuracy: 0.6900
CNN Error: 31.00%
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/1eb2ab2a076c5c41365de2d608095627980e1261.png" /></p>
</div>
</div>
<div class="cell markdown" id="hMoq5NFJPj3O">
<p>results: <br> pre anomaly removal (37x37)=val_loss: 1.1450 -
val_accuracy: 0.7003 <br> pre anomaly removal (131x131)=val_loss: 2.7943
- val_accuracy: 0.6197 <br> <br> post anomaly removal(37x37)=val_loss:
1.2753 - val_accuracy: 0.6970 <br> post anomaly removal
(131x131)=val_loss: 1.9097 - val_accuracy: 0.6900</p>
</div>
<div class="cell code" data-execution_count="59" id="PDst36Vr_bUt">
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>X_train_37 <span class="op">=</span> X_train_backup_37</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>y_train_37 <span class="op">=</span> y_train_backup_37</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>X_val_37 <span class="op">=</span> X_val_backup_37</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>y_val_37 <span class="op">=</span> y_val_backup_37</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>X_train_131 <span class="op">=</span> X_train_backup_131</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>y_train_131 <span class="op">=</span> y_train_backup_131</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>X_val_131 <span class="op">=</span> X_val_backup_131</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>y_val_131 <span class="op">=</span> y_val_backup_131</span></code></pre></div>
</div>
<div class="cell code" id="JWZLAUF8gasn">
<div class="sourceCode" id="cb35"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="24"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="f5Jg3AVikbC5" data-outputId="3406ce2f-530f-409e-bfdc-d4200960b1ae">
<div class="sourceCode" id="cb36"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train_37.shape)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_37.shape)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val_37.shape)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_val_37.shape)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train_131.shape)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_131.shape)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val_131.shape)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_val_131.shape)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>(9028, 37, 37)
(9028,)
(3000, 37, 37)
(3000,)
(9028, 131, 131)
(9028,)
(3000, 131, 131)
(3000,)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="25"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:983}"
id="oJorxtUR5m-R" data-outputId="6963c2ac-f5da-435b-e684-7fa0584a30ea">
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique class labels</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>unique_labels <span class="op">=</span> np.unique(y_train_37)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set figure size and number of rows and columns</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>fig_size <span class="op">=</span> (<span class="dv">20</span>, <span class="dv">12</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>rows, cols <span class="op">=</span> <span class="dv">5</span>, <span class="dv">3</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure with subplots</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(rows, cols, figsize<span class="op">=</span>fig_size)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>axs <span class="op">=</span> axs.ravel()  <span class="co"># Flatten the axs array</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over unique labels and display mean images</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, label <span class="kw">in</span> <span class="bu">enumerate</span>(unique_labels):</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter images belonging to the current class</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    class_mask <span class="op">=</span> y_train_37 <span class="op">==</span> label</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    class_images <span class="op">=</span> X_train_37[class_mask]</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate mean pixel values for the class</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    mean_pixels <span class="op">=</span> np.mean(class_images, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reshape mean pixels to original image shape</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    img_rows, img_cols <span class="op">=</span> X_train_37.shape[<span class="dv">1</span>], X_train_37.shape[<span class="dv">2</span>]</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    mean_image <span class="op">=</span> mean_pixels.reshape(img_rows, img_cols)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display the mean image for the class</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axs[i]</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>    ax.imshow(mean_image, cmap<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f&#39;Class </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>    ax.axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust spacing between subplots</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(wspace<span class="op">=</span><span class="fl">0.3</span>, hspace<span class="op">=</span><span class="fl">0.2</span>)  <span class="co"># Reduce vertical spacing (hspace)</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/8823f947599becb027ba1297555519fe5b0b3c66.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="26"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:983}"
id="fydFDwV9iv6v" data-outputId="78a64b5a-8af2-4b7d-ee27-175a90864d6d">
<div class="sourceCode" id="cb39"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique class labels</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>unique_labels <span class="op">=</span> np.unique(y_train_131)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set figure size and number of rows and columns</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>fig_size <span class="op">=</span> (<span class="dv">20</span>, <span class="dv">12</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>rows, cols <span class="op">=</span> <span class="dv">5</span>, <span class="dv">3</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure with subplots</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(rows, cols, figsize<span class="op">=</span>fig_size)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>axs <span class="op">=</span> axs.ravel()  <span class="co"># Flatten the axs array</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over unique labels and display mean images</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, label <span class="kw">in</span> <span class="bu">enumerate</span>(unique_labels):</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter images belonging to the current class</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    class_mask <span class="op">=</span> y_train_131 <span class="op">==</span> label</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    class_images <span class="op">=</span> X_train_131[class_mask]</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate mean pixel values for the class</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    mean_pixels <span class="op">=</span> np.mean(class_images, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reshape mean pixels to original image shape</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    img_rows, img_cols <span class="op">=</span> X_train_131.shape[<span class="dv">1</span>], X_train_131.shape[<span class="dv">2</span>]</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    mean_image <span class="op">=</span> mean_pixels.reshape(img_rows, img_cols)</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display the mean image for the class</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axs[i]</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>    ax.imshow(mean_image, cmap<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f&#39;Class </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    ax.axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust spacing between subplots</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(wspace<span class="op">=</span><span class="fl">0.3</span>, hspace<span class="op">=</span><span class="fl">0.2</span>)  <span class="co"># Reduce vertical spacing (hspace)</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/a755d16c0e5c101b02f0d563bbe31526681169c2.png" /></p>
</div>
</div>
<div class="cell markdown" id="xuXA0lBqZVDu">
<p>Here we can see that the average image of each class</p>
</div>
<div class="cell code" data-execution_count="27"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:564}"
id="wSFGVZX1zq3w" data-outputId="3c5e0282-9f92-4d95-9449-370c3f1e00da">
<div class="sourceCode" id="cb40"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have X_train and y_train loaded</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Count instances of each class</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>unique_labels, counts <span class="op">=</span> np.unique(y_train_37, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set figure size</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">6</span>))</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create bar chart</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>plt.bar(unique_labels, counts)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels and title</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Class Labels&#39;</span>)</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Number of Instances&#39;</span>)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Distribution of Classes in X_train&#39;</span>)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Show plot</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/eeeb9198f8069ec59a1fd48f7765418d6910d5e9.png" /></p>
</div>
</div>
<div class="cell markdown" id="xKWaymoyrXzZ">
<p>to address the issue of the dataset having an uneven number of values
for each class, i will be performing argumentation to make the number
the same.</p>
</div>
<div class="cell markdown" id="gF7hAP-1zs6W">
<h1>Undersampling</h1>
<p>undersampling makes all classes the same size as the smallest class,
this could potentially hhelp improve accuracy and reduce loss by
balancing the class distribution</p>
</div>
<div class="cell code" id="_GTg-JGW2rLt">
<div class="sourceCode" id="cb41"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>pip install imblearn</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="28" id="RLgGNdBqzriD">
<div class="sourceCode" id="cb42"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.under_sampling <span class="im">import</span> RandomUnderSampler</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> undersample_data(X_train, y_train):</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    y_train_flat <span class="op">=</span> [label <span class="cf">for</span> row <span class="kw">in</span> y_train <span class="cf">for</span> label <span class="kw">in</span> row]</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    class_counts <span class="op">=</span> Counter(y_train_flat)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    minority_class_size <span class="op">=</span> <span class="bu">min</span>(class_counts.values())</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    undersampler <span class="op">=</span> RandomUnderSampler(sampling_strategy<span class="op">=</span><span class="st">&#39;auto&#39;</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    X_train_2d <span class="op">=</span> X_train.reshape(X_train.shape[<span class="dv">0</span>], <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    X_train_undersampled, y_train_undersampled <span class="op">=</span> undersampler.fit_resample(X_train_2d, y_train)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>    X_train_undersampled_3d <span class="op">=</span> X_train_undersampled.reshape(X_train_undersampled.shape[<span class="dv">0</span>], <span class="op">*</span>X_train.shape[<span class="dv">1</span>:])</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X_train_undersampled_3d, y_train_undersampled</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="29" id="vOwGdxBszyOH">
<div class="sourceCode" id="cb43"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>X_train_37, y_train_37 <span class="op">=</span> undersample_data(X_train_37, y_train_37)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>X_train_131, y_train_131 <span class="op">=</span> undersample_data(X_train_131, y_train_131)</span></code></pre></div>
</div>
<div class="cell code" id="GTbCG_c32NBf">
<div class="sourceCode" id="cb44"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have X_train and y_train loaded</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Count instances of each class</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>unique_labels, counts <span class="op">=</span> np.unique(y_train_37, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set figure size</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">6</span>))</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create bar chart</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>plt.bar(unique_labels, counts)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels and title</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Class Labels&#39;</span>)</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Number of Instances&#39;</span>)</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Distribution of Classes in X_train&#39;</span>)</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Show plot</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="63"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
id="MQGyJiRC1Rln" data-outputId="860b7c3c-1963-4195-c9f9-0cc9543ef094">
<div class="sourceCode" id="cb45"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fix random seed for reproducibility</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.set_random_seed(<span class="dv">42</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>X_train_37, y_train_37, X_val_37, y_val_37, num_classes_37 <span class="op">=</span> preprocess_data(X_train_37, y_train_37, X_val_37, y_val_37)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> create_cnn_model(input_shape_37, num_classes)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(X_train_37, y_train_37, validation_data<span class="op">=</span>(X_val_37, y_val_37),</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>                    epochs<span class="op">=</span><span class="dv">100</span>, batch_size<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>[earlyStopping])</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Final evaluation of the model</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> model.evaluate(X_val_37, y_val_37, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;CNN Error: </span><span class="sc">%.2f%%</span><span class="st">&quot;</span> <span class="op">%</span> (<span class="dv">100</span><span class="op">-</span>scores[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>plot_accuracy_loss(history)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
38/38 [==============================] - 2s 27ms/step - loss: 4.4256 - accuracy: 0.0957 - val_loss: 2.6236 - val_accuracy: 0.1207
Epoch 2/100
38/38 [==============================] - 1s 23ms/step - loss: 2.5264 - accuracy: 0.1699 - val_loss: 2.4720 - val_accuracy: 0.1863
Epoch 3/100
38/38 [==============================] - 1s 21ms/step - loss: 2.3438 - accuracy: 0.2290 - val_loss: 2.3222 - val_accuracy: 0.2417
Epoch 4/100
38/38 [==============================] - 1s 21ms/step - loss: 2.1315 - accuracy: 0.3019 - val_loss: 2.2124 - val_accuracy: 0.2713
Epoch 5/100
38/38 [==============================] - 1s 21ms/step - loss: 1.9609 - accuracy: 0.3573 - val_loss: 2.2031 - val_accuracy: 0.2853
Epoch 6/100
38/38 [==============================] - 1s 22ms/step - loss: 1.8055 - accuracy: 0.4175 - val_loss: 2.1188 - val_accuracy: 0.3147
Epoch 7/100
38/38 [==============================] - 1s 21ms/step - loss: 1.6608 - accuracy: 0.4578 - val_loss: 1.8000 - val_accuracy: 0.4167
Epoch 8/100
38/38 [==============================] - 1s 21ms/step - loss: 1.4812 - accuracy: 0.5245 - val_loss: 1.9661 - val_accuracy: 0.3833
Epoch 9/100
38/38 [==============================] - 1s 22ms/step - loss: 1.3845 - accuracy: 0.5438 - val_loss: 1.7703 - val_accuracy: 0.4410
Epoch 10/100
38/38 [==============================] - 1s 22ms/step - loss: 1.2514 - accuracy: 0.5909 - val_loss: 1.8362 - val_accuracy: 0.4457
Epoch 11/100
38/38 [==============================] - 1s 21ms/step - loss: 1.1172 - accuracy: 0.6304 - val_loss: 1.7328 - val_accuracy: 0.4723
Epoch 12/100
38/38 [==============================] - 1s 22ms/step - loss: 0.9892 - accuracy: 0.6796 - val_loss: 1.5872 - val_accuracy: 0.5207
Epoch 13/100
38/38 [==============================] - 1s 20ms/step - loss: 0.8583 - accuracy: 0.7194 - val_loss: 1.6521 - val_accuracy: 0.4997
Epoch 14/100
38/38 [==============================] - 1s 20ms/step - loss: 0.8126 - accuracy: 0.7261 - val_loss: 1.6384 - val_accuracy: 0.5227
Epoch 15/100
38/38 [==============================] - 1s 21ms/step - loss: 0.6520 - accuracy: 0.7925 - val_loss: 1.6374 - val_accuracy: 0.5310
Epoch 16/100
38/38 [==============================] - 1s 20ms/step - loss: 0.5807 - accuracy: 0.8121 - val_loss: 1.5979 - val_accuracy: 0.5580
Epoch 17/100
38/38 [==============================] - 1s 21ms/step - loss: 0.4995 - accuracy: 0.8406 - val_loss: 1.7187 - val_accuracy: 0.5540
CNN Error: 44.60%
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/256afe25638c6dfaecc191acee6fb63a1dde0077.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="64"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:917}"
id="ztXEcM921Qlt" data-outputId="73b9b94f-d6c0-429c-92bd-b1bf44f1cf9d">
<div class="sourceCode" id="cb47"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.set_random_seed(<span class="dv">42</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>X_train_131, y_train_131, X_val_131, y_val_131, num_classes_131 <span class="op">=</span> preprocess_data(X_train_131, y_train_131, X_val_131, y_val_131)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> create_cnn_model(input_shape_131, num_classes)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(X_train_131, y_train_131, validation_data<span class="op">=</span>(X_val_131, y_val_131),</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>                    epochs<span class="op">=</span><span class="dv">100</span>, batch_size<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>[earlyStopping])</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Final evaluation of the model</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> model.evaluate(X_val_131, y_val_131, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;CNN Error: </span><span class="sc">%.2f%%</span><span class="st">&quot;</span> <span class="op">%</span> (<span class="dv">100</span><span class="op">-</span>scores[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>plot_accuracy_loss(history)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
38/38 [==============================] - 13s 327ms/step - loss: 7.2654 - accuracy: 0.1344 - val_loss: 2.4326 - val_accuracy: 0.1980
Epoch 2/100
38/38 [==============================] - 12s 323ms/step - loss: 2.0958 - accuracy: 0.3500 - val_loss: 2.0559 - val_accuracy: 0.3727
Epoch 3/100
38/38 [==============================] - 12s 328ms/step - loss: 1.4001 - accuracy: 0.5704 - val_loss: 1.8575 - val_accuracy: 0.4683
Epoch 4/100
38/38 [==============================] - 12s 328ms/step - loss: 0.8353 - accuracy: 0.7500 - val_loss: 1.9879 - val_accuracy: 0.5053
Epoch 5/100
38/38 [==============================] - 13s 331ms/step - loss: 0.4710 - accuracy: 0.8543 - val_loss: 2.2300 - val_accuracy: 0.5283
Epoch 6/100
38/38 [==============================] - 13s 332ms/step - loss: 0.3012 - accuracy: 0.9134 - val_loss: 2.5865 - val_accuracy: 0.4703
Epoch 7/100
38/38 [==============================] - 12s 328ms/step - loss: 0.2695 - accuracy: 0.9247 - val_loss: 2.5572 - val_accuracy: 0.5343
Epoch 8/100
38/38 [==============================] - 12s 327ms/step - loss: 0.1767 - accuracy: 0.9562 - val_loss: 3.0861 - val_accuracy: 0.5513
CNN Error: 44.87%
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/90a5c348f604ec1f76a414e30940fb14ed3301b4.png" /></p>
</div>
</div>
<div class="cell markdown" id="Hk9-7DsT2ix6">
<p><a
href="https://imbalanced-learn.org/stable/references/generated/imblearn.under_sampling.RandomUnderSampler.html"
class="uri">https://imbalanced-learn.org/stable/references/generated/imblearn.under_sampling.RandomUnderSampler.html</a></p>
</div>
<div class="cell markdown" id="ilaugRudAkcY">
<p>Holey moley! the accuracy has dropped significantly <br> results:
<br> pre anomaly removal (37x37)=val_loss: 1.1450 - val_accuracy: 0.7003
<br> pre anomaly removal (131x131)=val_loss: 2.7943 - val_accuracy:
0.6197 <br> <br> post anomaly removal(37x37)=val_loss: 1.2753 -
val_accuracy: 0.6970 <br> post anomaly removal (131x131)=val_loss:
1.9097 - val_accuracy: 0.6900 <br> <br> post undersampler
(37x37)=val_loss: 1.7187 - val_accuracy: 0.5540 <br> post undersampler
(131x131)=val_loss: 3.0861 - val_accuracy: 0.5513</p>
</div>
<div class="cell markdown" id="-0qvCJ7iO7GS">
<h1>Oversampling</h1>
<p>since some classes of the dataset are significantly smaller, i will
try oversampling to even out the dataset. oversampling consists of
artificially duplicating images</p>
</div>
<div class="cell code" data-execution_count="32" id="XEAyGeQZz7EH">
<div class="sourceCode" id="cb49"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>X_train_37 <span class="op">=</span> X_train_backup_37</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>y_train_37 <span class="op">=</span> y_train_backup_37</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>X_val_37 <span class="op">=</span> X_val_backup_37</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>y_val_37 <span class="op">=</span> y_val_backup_37</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>X_train_131 <span class="op">=</span> X_train_backup_131</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>y_train_131 <span class="op">=</span> y_train_backup_131</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>X_val_131 <span class="op">=</span> X_val_backup_131</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>y_val_131 <span class="op">=</span> y_val_backup_131</span></code></pre></div>
</div>
<div class="cell code" id="YGWZIQEdmAsH">
<div class="sourceCode" id="cb50"><pre
class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
<div class="cell code" data-execution_count="34" id="-WMvmqEOLPrm">
<div class="sourceCode" id="cb51"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.over_sampling <span class="im">import</span> RandomOverSampler</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> oversample_data(X_train, y_train):</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert y_train to a flattened list</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    y_train_flat <span class="op">=</span> [label <span class="cf">for</span> row <span class="kw">in</span> y_train <span class="cf">for</span> label <span class="kw">in</span> row]</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Count the number of instances for each class in y_train</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    class_counts <span class="op">=</span> Counter(y_train_flat)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the majority class size</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    majority_class_size <span class="op">=</span> <span class="bu">max</span>(class_counts.values())</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create an instance of RandomOverSampler</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    oversampler <span class="op">=</span> RandomOverSampler(sampling_strategy<span class="op">=</span><span class="st">&#39;auto&#39;</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reshape X_train to a 2D array</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    X_train_2d <span class="op">=</span> X_train.reshape(X_train.shape[<span class="dv">0</span>], <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit and apply the oversampler</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    X_train_oversampled, y_train_oversampled <span class="op">=</span> oversampler.fit_resample(X_train_2d, y_train)</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reshape X_train_oversampled back to its original 3D shape</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>    X_train_oversampled_3d <span class="op">=</span> X_train_oversampled.reshape(X_train_oversampled.shape[<span class="dv">0</span>], <span class="op">*</span>X_train.shape[<span class="dv">1</span>:])</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X_train_oversampled_3d, y_train_oversampled</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div class="cell markdown" id="PJ7Vgf1-2eIV">
<p><a
href="https://imbalanced-learn.org/stable/references/generated/imblearn.over_sampling.RandomOverSampler.html"
class="uri">https://imbalanced-learn.org/stable/references/generated/imblearn.over_sampling.RandomOverSampler.html</a></p>
</div>
<div class="cell code" data-execution_count="35" id="mad6V80HucB-">
<div class="sourceCode" id="cb52"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply oversampling to X_train_37, y_train_37</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>X_train_37_oversampled, y_train_37_oversampled <span class="op">=</span> oversample_data(X_train_37, y_train_37)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>X_train_37 <span class="op">=</span> X_train_37_oversampled</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>y_train_37 <span class="op">=</span> y_train_37_oversampled</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="36" id="ZE8WJ_kRty9T">
<div class="sourceCode" id="cb53"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply oversampling to X_train_131, y_train_131</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>X_train_131_oversampled, y_train_131_oversampled <span class="op">=</span> oversample_data(X_train_131, y_train_131)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>X_train_131 <span class="op">=</span> X_train_131_oversampled</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>y_train_131 <span class="op">=</span> y_train_131_oversampled</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="37"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="d4T5DB8HLPaA" data-outputId="4fe2a4b9-6344-45a1-d550-a77895c84fee">
<div class="sourceCode" id="cb54"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train_37.shape)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_37.shape)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val_37.shape)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_val_37.shape)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train_131.shape)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_131.shape)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val_131.shape)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_val_131.shape)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>(14325, 37, 37)
(14325,)
(3000, 37, 37)
(3000,)
(14325, 131, 131)
(14325,)
(3000, 131, 131)
(3000,)
</code></pre>
</div>
</div>
<div class="cell markdown" id="Fy5PHd5ULRqH">
<p>we can see that the dataset has been expandedd significantly, which
gives the</p>
</div>
<div class="cell code" data-execution_count="38"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
id="Yvbx4V1vLpqW" data-outputId="36bd2fff-5f14-4bf4-a306-1c730f23fe75">
<div class="sourceCode" id="cb56"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co"># fix random seed for reproducibility</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.set_random_seed(<span class="dv">42</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>X_train_37, y_train_37, X_val_37, y_val_37, num_classes_37 <span class="op">=</span> preprocess_data(X_train_37, y_train_37, X_val_37, y_val_37)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> create_cnn_model(input_shape_37, num_classes)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(X_train_37, y_train_37, validation_data<span class="op">=</span>(X_val_37, y_val_37),</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>                    epochs<span class="op">=</span><span class="dv">100</span>, batch_size<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>[earlyStopping])</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Final evaluation of the model</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> model.evaluate(X_val_37, y_val_37, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;CNN Error: </span><span class="sc">%.2f%%</span><span class="st">&quot;</span> <span class="op">%</span> (<span class="dv">100</span><span class="op">-</span>scores[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>plot_accuracy_loss(history)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
144/144 [==============================] - 4s 19ms/step - loss: 2.8290 - accuracy: 0.1893 - val_loss: 2.2123 - val_accuracy: 0.2817
Epoch 2/100
144/144 [==============================] - 3s 18ms/step - loss: 1.8604 - accuracy: 0.3916 - val_loss: 1.9230 - val_accuracy: 0.4113
Epoch 3/100
144/144 [==============================] - 3s 18ms/step - loss: 1.4374 - accuracy: 0.5362 - val_loss: 1.5784 - val_accuracy: 0.4980
Epoch 4/100
144/144 [==============================] - 3s 18ms/step - loss: 1.1620 - accuracy: 0.6279 - val_loss: 1.4968 - val_accuracy: 0.5283
Epoch 5/100
144/144 [==============================] - 3s 18ms/step - loss: 0.9219 - accuracy: 0.7052 - val_loss: 1.3293 - val_accuracy: 0.5997
Epoch 6/100
144/144 [==============================] - 3s 19ms/step - loss: 0.7092 - accuracy: 0.7785 - val_loss: 1.2902 - val_accuracy: 0.6110
Epoch 7/100
144/144 [==============================] - 3s 17ms/step - loss: 0.5447 - accuracy: 0.8297 - val_loss: 1.2854 - val_accuracy: 0.6447
Epoch 8/100
144/144 [==============================] - 3s 19ms/step - loss: 0.4351 - accuracy: 0.8644 - val_loss: 1.3540 - val_accuracy: 0.6467
Epoch 9/100
144/144 [==============================] - 3s 18ms/step - loss: 0.3720 - accuracy: 0.8837 - val_loss: 1.3494 - val_accuracy: 0.6723
Epoch 10/100
144/144 [==============================] - 3s 19ms/step - loss: 0.2778 - accuracy: 0.9163 - val_loss: 1.3185 - val_accuracy: 0.6810
Epoch 11/100
144/144 [==============================] - 3s 18ms/step - loss: 0.2120 - accuracy: 0.9358 - val_loss: 1.4765 - val_accuracy: 0.6690
Epoch 12/100
144/144 [==============================] - 2s 17ms/step - loss: 0.1992 - accuracy: 0.9354 - val_loss: 1.3137 - val_accuracy: 0.7187
CNN Error: 28.13%
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/e6afc8aab1db30c750e21d63508b3591da4b174b.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="39"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:881}"
id="RCSK9UhbLQYc" data-outputId="5edd37a2-3d0b-412f-fac2-a540638285ed">
<div class="sourceCode" id="cb58"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># fix random seed for reproducibility</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.set_random_seed(<span class="dv">42</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>X_train_131, y_train_131, X_val_131, y_val_131, num_classes_131 <span class="op">=</span> preprocess_data(X_train_131, y_train_131, X_val_131, y_val_131)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> create_cnn_model(input_shape_131, num_classes)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(X_train_131, y_train_131, validation_data<span class="op">=</span>(X_val_131, y_val_131),</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>                    epochs<span class="op">=</span><span class="dv">100</span>, batch_size<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>[earlyStopping])</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Final evaluation of the model</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> model.evaluate(X_val_131, y_val_131, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;CNN Error: </span><span class="sc">%.2f%%</span><span class="st">&quot;</span> <span class="op">%</span> (<span class="dv">100</span><span class="op">-</span>scores[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>plot_accuracy_loss(history)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
144/144 [==============================] - 43s 292ms/step - loss: 3.2607 - accuracy: 0.3598 - val_loss: 1.6493 - val_accuracy: 0.5210
Epoch 2/100
144/144 [==============================] - 42s 290ms/step - loss: 0.8632 - accuracy: 0.7533 - val_loss: 1.4953 - val_accuracy: 0.6150
Epoch 3/100
144/144 [==============================] - 42s 293ms/step - loss: 0.3711 - accuracy: 0.8932 - val_loss: 1.7556 - val_accuracy: 0.6287
Epoch 4/100
144/144 [==============================] - 42s 289ms/step - loss: 0.1887 - accuracy: 0.9465 - val_loss: 2.2813 - val_accuracy: 0.6330
Epoch 5/100
144/144 [==============================] - 41s 285ms/step - loss: 0.1686 - accuracy: 0.9520 - val_loss: 2.4520 - val_accuracy: 0.6120
Epoch 6/100
144/144 [==============================] - 41s 286ms/step - loss: 0.1368 - accuracy: 0.9631 - val_loss: 2.8106 - val_accuracy: 0.6377
Epoch 7/100
144/144 [==============================] - 42s 289ms/step - loss: 0.0651 - accuracy: 0.9809 - val_loss: 3.0563 - val_accuracy: 0.6263
CNN Error: 37.37%
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/ab47305f182d2fea070183e9d65fb1738751d8db.png" /></p>
</div>
</div>
<div class="cell markdown" id="bPgVvdLSE_-i">
<p><br> results: <br> pre anomaly removal (37x37)=val_loss: 1.1450 -
val_accuracy: 0.7003 <br> pre anomaly removal (131x131)=val_loss: 2.7943
- val_accuracy: 0.6197 <br> <br> post anomaly removal(37x37)=val_loss:
1.2753 - val_accuracy: 0.6970 <br> post anomaly removal
(131x131)=val_loss: 1.9097 - val_accuracy: 0.6900 <br> <br> post
undersampler (37x37)=val_loss: 1.7187 - val_accuracy: 0.5540 <br> post
undersampler (131x131)=val_loss: 3.0861 - val_accuracy: 0.5513 <br> <br>
post oversampler (37x37)=val_loss: 1.3137 - val_accuracy: 0.7187 <br>
post oversampler (131x131)=val_loss: 3.0563 - val_accuracy: 0.6263</p>
</div>
<div class="cell code" data-execution_count="40" id="sbt93p5gaZv-">
<div class="sourceCode" id="cb60"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>X_train_37 <span class="op">=</span> X_train_backup_37</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>y_train_37 <span class="op">=</span> y_train_backup_37</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>X_val_37 <span class="op">=</span> X_val_backup_37</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>y_val_37 <span class="op">=</span> y_val_backup_37</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>X_train_131 <span class="op">=</span> X_train_backup_131</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>y_train_131 <span class="op">=</span> y_train_backup_131</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>X_val_131 <span class="op">=</span> X_val_backup_131</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>y_val_131 <span class="op">=</span> y_val_backup_131</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="41" id="qQmPq1MA2ki8">
<div class="sourceCode" id="cb61"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.preprocessing.image <span class="im">import</span> ImageDataGenerator</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> augment_data(X_train, y_train, X_val, y_val):</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_gaussian_noise(image):</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>        row, col, ch <span class="op">=</span> image.shape</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>        mean <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>        var <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>        sigma <span class="op">=</span> var <span class="op">**</span> <span class="fl">0.5</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>        gauss <span class="op">=</span> np.random.normal(mean, sigma, (row, col, ch))</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>        gauss <span class="op">=</span> gauss.reshape(row, col, ch)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>        noisy_image <span class="op">=</span> image <span class="op">+</span> gauss</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> noisy_image</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    data_generator_1 <span class="op">=</span> ImageDataGenerator(</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>        horizontal_flip<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>        rotation_range<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>        fill_mode<span class="op">=</span><span class="st">&#39;nearest&#39;</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>    data_generator_2 <span class="op">=</span> ImageDataGenerator(</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>        preprocessing_function<span class="op">=</span>add_gaussian_noise,</span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>        vertical_flip<span class="op">=</span><span class="va">True</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> np.expand_dims(X_train, axis<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply data_generator_1 to X_train</span></span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>    data_generator_1.fit(X_train)</span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>    augmented_X_train_1 <span class="op">=</span> data_generator_1.flow(X_train, batch_size<span class="op">=</span><span class="bu">len</span>(X_train), shuffle<span class="op">=</span><span class="va">False</span>).<span class="bu">next</span>()</span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine original X_train and augmented X_train_1</span></span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>    X_train_1 <span class="op">=</span> np.concatenate([X_train, augmented_X_train_1], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply data_generator_2 to X_train_1</span></span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>    data_generator_2.fit(X_train_1)</span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a>    augmented_X_train_2 <span class="op">=</span> data_generator_2.flow(X_train_1, batch_size<span class="op">=</span><span class="bu">len</span>(X_train_1), shuffle<span class="op">=</span><span class="va">False</span>).<span class="bu">next</span>()</span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine X_train_1 and augmented X_train_2</span></span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> np.concatenate([X_train_1, augmented_X_train_2], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Duplicate y_train to match the augmented X_train</span></span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> np.concatenate([y_train, y_train, y_train, y_train], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Shuffle the augmented data</span></span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> np.arange(<span class="bu">len</span>(X_train))</span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a>    np.random.shuffle(indices)</span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X_train[indices]</span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y_train[indices]</span>
<span id="cb61-52"><a href="#cb61-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-53"><a href="#cb61-53" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X_train.reshape(<span class="op">-</span><span class="dv">1</span>, X_train.shape[<span class="dv">1</span>], X_train.shape[<span class="dv">2</span>])</span>
<span id="cb61-54"><a href="#cb61-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X_train, y_train, X_val, y_val</span>
<span id="cb61-56"><a href="#cb61-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-57"><a href="#cb61-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-58"><a href="#cb61-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-59"><a href="#cb61-59" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div class="cell markdown" id="tfX45eFbE8eT">
<p><a
href="https://www.tensorflow.org/api_docs/python/tf/keras/preprocessing/image/ImageDataGenerator"
class="uri">https://www.tensorflow.org/api_docs/python/tf/keras/preprocessing/image/ImageDataGenerator</a></p>
</div>
<div class="cell markdown" id="QIyefZZQRLUN">
<p>what does my augmenter do: ffirst, it flips the dataset horizontally,
rotates it in a range of 20 degrees, then fills the empty space with the
nearest pixel, then data generator 2 adds noise, which hopefully
prevents overfitting, then it flips the image vertically</p>
</div>
<div class="cell code" data-execution_count="43" id="K1rtWROOCHjv">
<div class="sourceCode" id="cb62"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply data augmentation to X_train_37, y_train_37, X_val_37, y_val_37</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>X_train_37, y_train_37, X_val_37, y_val_37 <span class="op">=</span> augment_data(X_train_37, y_train_37, X_val_37, y_val_37)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply data augmentation to X_train_131, y_train_131, X_val_131, y_val_131</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>X_train_131, y_train_131, X_val_131, y_val_131 <span class="op">=</span> augment_data(X_train_131, y_train_131, X_val_131, y_val_131)</span></code></pre></div>
</div>
<div class="cell code" id="G4kL0nf0uA7z">
<div class="sourceCode" id="cb63"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train_37.shape)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_37.shape)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val_37.shape)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_val_37.shape)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train_131.shape)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_131.shape)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val_131.shape)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_val_131.shape)</span></code></pre></div>
</div>
<div class="cell markdown" id="HfQtrLr4SWUU">
<p>i have x4ed the dataset by augmenting the data, by using the
augmentations to expand the size of the dataset</p>
</div>
<div class="cell code" data-execution_count="44"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
id="aAPbu3LRCYHz" data-outputId="d1afe6e4-41ae-40d5-d69f-b22d65854455">
<div class="sourceCode" id="cb64"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co"># fix random seed for reproducibility</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.set_random_seed(<span class="dv">42</span>)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>X_train_37, y_train_37, X_val_37, y_val_37, num_classes_37 <span class="op">=</span> preprocess_data(X_train_37, y_train_37, X_val_37, y_val_37)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> create_cnn_model(input_shape_37, num_classes)</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(X_train_37, y_train_37, validation_data<span class="op">=</span>(X_val_37, y_val_37),</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>                    epochs<span class="op">=</span><span class="dv">100</span>, batch_size<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>[earlyStopping])</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Final evaluation of the model</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> model.evaluate(X_val_37, y_val_37, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;CNN Error: </span><span class="sc">%.2f%%</span><span class="st">&quot;</span> <span class="op">%</span> (<span class="dv">100</span><span class="op">-</span>scores[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>plot_accuracy_loss(history)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
362/362 [==============================] - 8s 17ms/step - loss: 2.4600 - accuracy: 0.2247 - val_loss: 2.3608 - val_accuracy: 0.2467
Epoch 2/100
362/362 [==============================] - 6s 15ms/step - loss: 1.8594 - accuracy: 0.3845 - val_loss: 1.7634 - val_accuracy: 0.4180
Epoch 3/100
362/362 [==============================] - 6s 16ms/step - loss: 1.5393 - accuracy: 0.4922 - val_loss: 1.3491 - val_accuracy: 0.5450
Epoch 4/100
362/362 [==============================] - 6s 16ms/step - loss: 1.2624 - accuracy: 0.5879 - val_loss: 1.2660 - val_accuracy: 0.5893
Epoch 5/100
362/362 [==============================] - 6s 17ms/step - loss: 1.0547 - accuracy: 0.6556 - val_loss: 1.0929 - val_accuracy: 0.6457
Epoch 6/100
362/362 [==============================] - 6s 16ms/step - loss: 0.8858 - accuracy: 0.7136 - val_loss: 1.0094 - val_accuracy: 0.6893
Epoch 7/100
362/362 [==============================] - 6s 16ms/step - loss: 0.7508 - accuracy: 0.7564 - val_loss: 1.0018 - val_accuracy: 0.7037
Epoch 8/100
362/362 [==============================] - 6s 15ms/step - loss: 0.6535 - accuracy: 0.7864 - val_loss: 1.0508 - val_accuracy: 0.7020
Epoch 9/100
362/362 [==============================] - 6s 16ms/step - loss: 0.5577 - accuracy: 0.8169 - val_loss: 1.1543 - val_accuracy: 0.6833
Epoch 10/100
362/362 [==============================] - 6s 16ms/step - loss: 0.5143 - accuracy: 0.8325 - val_loss: 0.9789 - val_accuracy: 0.7367
Epoch 11/100
362/362 [==============================] - 6s 16ms/step - loss: 0.4521 - accuracy: 0.8494 - val_loss: 0.9907 - val_accuracy: 0.7427
Epoch 12/100
362/362 [==============================] - 6s 16ms/step - loss: 0.4086 - accuracy: 0.8645 - val_loss: 1.1806 - val_accuracy: 0.7187
Epoch 13/100
362/362 [==============================] - 6s 16ms/step - loss: 0.3552 - accuracy: 0.8837 - val_loss: 1.1284 - val_accuracy: 0.7377
Epoch 14/100
362/362 [==============================] - 6s 16ms/step - loss: 0.3349 - accuracy: 0.8886 - val_loss: 1.2612 - val_accuracy: 0.7310
Epoch 15/100
362/362 [==============================] - 6s 16ms/step - loss: 0.3198 - accuracy: 0.8940 - val_loss: 1.2715 - val_accuracy: 0.7217
CNN Error: 27.83%
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/6dad116e23de2204aeae727cfee6cba5af213a17.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="45"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:881}"
id="_NE7WfCCCbOA" data-outputId="ae343be9-2c47-4b4b-9bb0-29ea870873d7">
<div class="sourceCode" id="cb66"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.set_random_seed(<span class="dv">42</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>X_train_131, y_train_131, X_val_131, y_val_131, num_classes_131 <span class="op">=</span> preprocess_data(X_train_131, y_train_131, X_val_131, y_val_131)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> create_cnn_model(input_shape_131, num_classes)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(X_train_131, y_train_131, validation_data<span class="op">=</span>(X_val_131, y_val_131),</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>                    epochs<span class="op">=</span><span class="dv">100</span>, batch_size<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>[earlyStopping])</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Final evaluation of the model</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> model.evaluate(X_val_131, y_val_131, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;CNN Error: </span><span class="sc">%.2f%%</span><span class="st">&quot;</span> <span class="op">%</span> (<span class="dv">100</span><span class="op">-</span>scores[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>plot_accuracy_loss(history)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
362/362 [==============================] - 102s 279ms/step - loss: 2.4583 - accuracy: 0.4013 - val_loss: 1.3774 - val_accuracy: 0.5787
Epoch 2/100
362/362 [==============================] - 99s 274ms/step - loss: 0.9234 - accuracy: 0.7095 - val_loss: 1.1256 - val_accuracy: 0.6830
Epoch 3/100
362/362 [==============================] - 100s 277ms/step - loss: 0.4953 - accuracy: 0.8464 - val_loss: 1.1794 - val_accuracy: 0.7060
Epoch 4/100
362/362 [==============================] - 100s 275ms/step - loss: 0.2856 - accuracy: 0.9121 - val_loss: 1.2709 - val_accuracy: 0.7360
Epoch 5/100
362/362 [==============================] - 98s 271ms/step - loss: 0.1678 - accuracy: 0.9487 - val_loss: 1.5114 - val_accuracy: 0.7403
Epoch 6/100
362/362 [==============================] - 98s 271ms/step - loss: 0.1411 - accuracy: 0.9555 - val_loss: 2.0593 - val_accuracy: 0.6970
Epoch 7/100
362/362 [==============================] - 97s 269ms/step - loss: 0.1287 - accuracy: 0.9610 - val_loss: 1.6853 - val_accuracy: 0.7410
CNN Error: 25.90%
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/88477c14b8319764fb7ea4da25441d325146577c.png" /></p>
</div>
</div>
<div class="cell markdown" id="gGklb1efGjCo">
<p><br> results: <br> pre anomaly removal (37x37)=val_loss: 1.1450 -
val_accuracy: 0.7003 <br> pre anomaly removal (131x131)=val_loss: 2.7943
- val_accuracy: 0.6197 <br> <br> post anomaly removal(37x37)=val_loss:
1.2753 - val_accuracy: 0.6970 <br> post anomaly removal
(131x131)=val_loss: 1.9097 - val_accuracy: 0.6900 <br> <br> post
undersampler (37x37)=val_loss: 1.7187 - val_accuracy: 0.5540 <br> post
undersampler (131x131)=val_loss: 3.0861 - val_accuracy: 0.5513 <br> <br>
post oversampler (37x37)=val_loss: 1.3137 - val_accuracy: 0.7187 <br>
post oversampler (131x131)=val_loss: 3.0563 - val_accuracy: 0.6263 <br>
<br> post augment (37x37)=val_loss: 1.2715 - val_accuracy: 0.7217 <br>
post augment(131x131)=val_loss: 1.6853 - val_accuracy: 0.7410</p>
</div>
<div class="cell markdown" id="_mR22AvVx2Yw">
<p>since oversampling and augmenting seemed to have improved the 37x37
dataset, lets try doing them both.</p>
</div>
<div class="cell code" data-execution_count="67" id="LcwBkm_t5Wxy">
<div class="sourceCode" id="cb68"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>X_train_37 <span class="op">=</span> X_train_backup_37</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>y_train_37 <span class="op">=</span> y_train_backup_37</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>X_val_37 <span class="op">=</span> X_val_backup_37</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>y_val_37 <span class="op">=</span> y_val_backup_37</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>X_train_131 <span class="op">=</span> X_train_backup_131</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>y_train_131 <span class="op">=</span> y_train_backup_131</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>X_val_131 <span class="op">=</span> X_val_backup_131</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>y_val_131 <span class="op">=</span> y_val_backup_131</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="68" id="xhgeMEonMvZC">
<div class="sourceCode" id="cb69"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply undersampling to X_train_37, y_train_37, X_val_37, y_val_37</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply data augmentation to X_train_131, y_train_131, X_val_131, y_val_131</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>X_train_131, y_train_131, X_val_131, y_val_131 <span class="op">=</span> augment_data(X_train_131, y_train_131, X_val_131, y_val_131)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>X_train_131, y_train_131<span class="op">=</span> undersample_data(X_train_131, y_train_131)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply oversampling to X_train_37, y_train_37</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply data augmentation to X_train_37, y_train_37, X_val_37, y_val_37</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>X_train_37, y_train_37, X_val_37, y_val_37 <span class="op">=</span> augment_data(X_train_37, y_train_37, X_val_37, y_val_37)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>X_train_37, y_train_37 <span class="op">=</span> oversample_data(X_train_37, y_train_37)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="69"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:953}"
id="HALMMSLSNFJU" data-outputId="6e11f347-513d-4de2-b2d1-c894a2be9033">
<div class="sourceCode" id="cb70"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.set_random_seed(<span class="dv">42</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>X_train_37, y_train_37, X_val_37, y_val_37, num_classes_37 <span class="op">=</span> preprocess_data(X_train_37, y_train_37, X_val_37, y_val_37)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> create_cnn_model(input_shape_37, num_classes)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(X_train_37, y_train_37, validation_data<span class="op">=</span>(X_val_37, y_val_37),</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>                    epochs<span class="op">=</span><span class="dv">100</span>, batch_size<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>[earlyStopping])</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Final evaluation of the model</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> model.evaluate(X_val_37, y_val_37, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;CNN Error: </span><span class="sc">%.2f%%</span><span class="st">&quot;</span> <span class="op">%</span> (<span class="dv">100</span><span class="op">-</span>scores[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>plot_accuracy_loss(history)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
573/573 [==============================] - 10s 16ms/step - loss: 2.1547 - accuracy: 0.3164 - val_loss: 1.4303 - val_accuracy: 0.5220
Epoch 2/100
573/573 [==============================] - 9s 16ms/step - loss: 1.2982 - accuracy: 0.5792 - val_loss: 1.1063 - val_accuracy: 0.6523
Epoch 3/100
573/573 [==============================] - 9s 15ms/step - loss: 0.9103 - accuracy: 0.7104 - val_loss: 1.1137 - val_accuracy: 0.6777
Epoch 4/100
573/573 [==============================] - 10s 17ms/step - loss: 0.6854 - accuracy: 0.7821 - val_loss: 0.9446 - val_accuracy: 0.7227
Epoch 5/100
573/573 [==============================] - 9s 16ms/step - loss: 0.5352 - accuracy: 0.8297 - val_loss: 1.0432 - val_accuracy: 0.7300
Epoch 6/100
573/573 [==============================] - 9s 17ms/step - loss: 0.4207 - accuracy: 0.8657 - val_loss: 1.0388 - val_accuracy: 0.7487
Epoch 7/100
573/573 [==============================] - 10s 17ms/step - loss: 0.3661 - accuracy: 0.8822 - val_loss: 1.0619 - val_accuracy: 0.7620
Epoch 8/100
573/573 [==============================] - 10s 17ms/step - loss: 0.3047 - accuracy: 0.9017 - val_loss: 1.2388 - val_accuracy: 0.7433
Epoch 9/100
573/573 [==============================] - 10s 17ms/step - loss: 0.2666 - accuracy: 0.9139 - val_loss: 1.2488 - val_accuracy: 0.7493
CNN Error: 25.07%
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/23f24ea6431cecea98365d5040a0c30d8bbb1617.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="70"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:917}"
id="7BBNT64yNJC8" data-outputId="40fe15ce-40e9-4b2e-8e9e-4946078d3580">
<div class="sourceCode" id="cb72"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.set_random_seed(<span class="dv">42</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>X_train_131, y_train_131, X_val_131, y_val_131, num_classes_131 <span class="op">=</span> preprocess_data(X_train_131, y_train_131, X_val_131, y_val_131)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> create_cnn_model(input_shape_131, num_classes)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(X_train_131, y_train_131, validation_data<span class="op">=</span>(X_val_131, y_val_131),</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>                    epochs<span class="op">=</span><span class="dv">100</span>, batch_size<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>[earlyStopping])</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Final evaluation of the model</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> model.evaluate(X_val_131, y_val_131, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;CNN Error: </span><span class="sc">%.2f%%</span><span class="st">&quot;</span> <span class="op">%</span> (<span class="dv">100</span><span class="op">-</span>scores[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>plot_accuracy_loss(history)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
149/149 [==============================] - 45s 293ms/step - loss: 3.5852 - accuracy: 0.2381 - val_loss: 1.8334 - val_accuracy: 0.4230
Epoch 2/100
149/149 [==============================] - 43s 292ms/step - loss: 1.6269 - accuracy: 0.4849 - val_loss: 1.5840 - val_accuracy: 0.5197
Epoch 3/100
149/149 [==============================] - 43s 292ms/step - loss: 1.1794 - accuracy: 0.6353 - val_loss: 1.4629 - val_accuracy: 0.5957
Epoch 4/100
149/149 [==============================] - 43s 292ms/step - loss: 0.7431 - accuracy: 0.7698 - val_loss: 1.6040 - val_accuracy: 0.6187
Epoch 5/100
149/149 [==============================] - 44s 293ms/step - loss: 0.4545 - accuracy: 0.8583 - val_loss: 1.9666 - val_accuracy: 0.6180
Epoch 6/100
149/149 [==============================] - 44s 294ms/step - loss: 0.3032 - accuracy: 0.9088 - val_loss: 2.2392 - val_accuracy: 0.6253
Epoch 7/100
149/149 [==============================] - 44s 293ms/step - loss: 0.2299 - accuracy: 0.9314 - val_loss: 3.0391 - val_accuracy: 0.5540
Epoch 8/100
149/149 [==============================] - 43s 287ms/step - loss: 0.2194 - accuracy: 0.9358 - val_loss: 2.4662 - val_accuracy: 0.6223
CNN Error: 37.77%
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/eb27fea98a6018192a5413293878cd43320d2a87.png" /></p>
</div>
</div>
<div class="cell markdown" id="T8JYOTTayjVC">
<p><br> results: <br> pre anomaly removal (37x37)=val_loss: 1.1450 -
val_accuracy: 0.7003 <br> pre anomaly removal (131x131)=val_loss: 2.7943
- val_accuracy: 0.6197 <br> <br> post anomaly removal(37x37)=val_loss:
1.2753 - val_accuracy: 0.6970 <br> post anomaly removal
(131x131)=val_loss: 1.9097 - val_accuracy: 0.6900 <br> <br> post
undersampler (37x37)=val_loss: 1.7187 - val_accuracy: 0.5540 <br> post
undersampler (131x131)=val_loss: 3.0861 - val_accuracy: 0.5513 <br> <br>
post oversampler (37x37)=val_loss: 1.3137 - val_accuracy: 0.7187 <br>
post oversampler (131x131)=val_loss: 3.0563 - val_accuracy: 0.6263 <br>
<br> post augment (37x37)=val_loss: 1.2715 - val_accuracy: 0.7217 <br>
post augment(131x131)=val_loss: 1.6853 - val_accuracy: 0.7410 <br> <br>
post augment+oversample(37x37)=val_loss: 1.2488 - val_accuracy: 0.7493
<br> post augment+undersample(131x131)=val_loss: 2.4662 - val_accuracy:
0.6223 <br> <br> best: post augment+oversample(37x37)=val_loss: 1.2488 -
val_accuracy: 0.7493 best: post augment(131x131)=val_loss: 1.6853 -
val_accuracy: 0.7410</p>
</div>
<div class="cell markdown" id="Cz2vTDkUy0uC">
<p>from the results of all the tests, i will proceed with augmenting and
oversampling for 37x37, and just augmenting for 131x131</p>
</div>
<div class="cell code" data-execution_count="51"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="lAf5IhhxyEq3" data-outputId="36822d9d-0ed2-4265-98d4-70e5e5074306">
<div class="sourceCode" id="cb74"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train_37.shape)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_37.shape)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val_37.shape)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_val_37.shape)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train_131.shape)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_131.shape)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val_131.shape)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_val_131.shape)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>(57300, 37, 37)
(57300, 15)
(3000, 37, 37)
(3000, 15)
(14880, 131, 131)
(14880, 15)
(3000, 131, 131)
(3000, 15)
</code></pre>
</div>
</div>
<div class="cell markdown" id="VRCICiPa5nRv">
<h1>Modelling and evaluation</h1>
<p>now we will commence modelling and evaluation, i apply normalisation,
then normalisation and dropout to the model and see how it affects the
results</p>
</div>
<div class="cell code" data-execution_count="91" id="VHS7R3s96dZE">
<div class="sourceCode" id="cb76"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>X_train_37 <span class="op">=</span> X_train_backup_37</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>y_train_37 <span class="op">=</span> y_train_backup_37</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>X_val_37 <span class="op">=</span> X_val_backup_37</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>y_val_37 <span class="op">=</span> y_val_backup_37</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>X_train_131 <span class="op">=</span> X_train_backup_131</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>y_train_131 <span class="op">=</span> y_train_backup_131</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>X_val_131 <span class="op">=</span> X_val_backup_131</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>y_val_131 <span class="op">=</span> y_val_backup_131</span></code></pre></div>
</div>
<div class="cell markdown" id="oxrZKeIk7WmV">

</div>
<div class="cell code" data-execution_count="92" id="aE3RihtU5mxc">
<div class="sourceCode" id="cb77"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># from tensorflow.keras.layers import BatchNormalization</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_cnn_model(input_shape, num_classes):</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Sequential()</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(<span class="dv">32</span>, (<span class="dv">3</span>, <span class="dv">3</span>), input_shape<span class="op">=</span>input_shape, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>))</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    model.add(BatchNormalization())  <span class="co"># Add batch normalization layer</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    model.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(<span class="dv">64</span>, (<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>))</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    model.add(BatchNormalization())  <span class="co"># Add batch normalization layer</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    model.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(<span class="dv">64</span>, (<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>))</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>    model.add(BatchNormalization())  <span class="co"># Add batch normalization layer</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>    model.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>    model.add(Flatten())</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>    model.add(Dense(<span class="dv">128</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>))</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>    model.add(BatchNormalization())  <span class="co"># Add batch normalization layer</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>    model.add(Dense(num_classes, activation<span class="op">=</span><span class="st">&#39;softmax&#39;</span>))</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">&#39;categorical_crossentropy&#39;</span>,</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>                  optimizer<span class="op">=</span><span class="st">&#39;adam&#39;</span>,</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>                  metrics<span class="op">=</span>[<span class="st">&#39;accuracy&#39;</span>])</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="93" id="EoOSmCdN6im-">
<div class="sourceCode" id="cb78"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>X_train_37, y_train_37, X_val_37, y_val_37 <span class="op">=</span> augment_data(X_train_37, y_train_37, X_val_37, y_val_37)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>X_train_37, y_train_37 <span class="op">=</span> oversample_data(X_train_37, y_train_37)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="94"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="R82FOrdH-vP4" data-outputId="21638701-ebb4-492d-9c40-a664ac88c272">
<div class="sourceCode" id="cb79"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train_37.shape)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_37.shape)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val_37.shape)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_val_37.shape)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train_131.shape)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_131.shape)</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val_131.shape)</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_val_131.shape)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>(57300, 37, 37)
(57300,)
(3000, 37, 37)
(3000,)
(9028, 131, 131)
(9028,)
(3000, 131, 131)
(3000,)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="95"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:917}"
id="bz8-HMON6wOV" data-outputId="493fdd77-22c7-4f04-aa9d-a6e314dc8481">
<div class="sourceCode" id="cb81"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.set_random_seed(<span class="dv">42</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>X_train_37, y_train_37, X_val_37, y_val_37, num_classes_37 <span class="op">=</span> preprocess_data(X_train_37, y_train_37, X_val_37, y_val_37)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> create_cnn_model(input_shape_37, num_classes)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(X_train_37, y_train_37, validation_data<span class="op">=</span>(X_val_37, y_val_37),</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>                    epochs<span class="op">=</span><span class="dv">100</span>, batch_size<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>[earlyStopping])</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Final evaluation of the model</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> model.evaluate(X_val_37, y_val_37, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;CNN Error: </span><span class="sc">%.2f%%</span><span class="st">&quot;</span> <span class="op">%</span> (<span class="dv">100</span><span class="op">-</span>scores[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>plot_accuracy_loss(history)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
573/573 [==============================] - 20s 33ms/step - loss: 1.4179 - accuracy: 0.5497 - val_loss: 1.0790 - val_accuracy: 0.6467
Epoch 2/100
573/573 [==============================] - 18s 32ms/step - loss: 0.6320 - accuracy: 0.8036 - val_loss: 0.8340 - val_accuracy: 0.7387
Epoch 3/100
573/573 [==============================] - 18s 31ms/step - loss: 0.3744 - accuracy: 0.8850 - val_loss: 0.7010 - val_accuracy: 0.7930
Epoch 4/100
573/573 [==============================] - 18s 31ms/step - loss: 0.2565 - accuracy: 0.9214 - val_loss: 0.8417 - val_accuracy: 0.7783
Epoch 5/100
573/573 [==============================] - 17s 30ms/step - loss: 0.1836 - accuracy: 0.9442 - val_loss: 0.9591 - val_accuracy: 0.7473
Epoch 6/100
573/573 [==============================] - 17s 30ms/step - loss: 0.1409 - accuracy: 0.9571 - val_loss: 0.8195 - val_accuracy: 0.7820
Epoch 7/100
573/573 [==============================] - 17s 30ms/step - loss: 0.1176 - accuracy: 0.9638 - val_loss: 1.2905 - val_accuracy: 0.7207
Epoch 8/100
573/573 [==============================] - 17s 30ms/step - loss: 0.0928 - accuracy: 0.9719 - val_loss: 0.8481 - val_accuracy: 0.7993
CNN Error: 20.07%
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/40c0ddc737373cfdc1e29f141e075be90562eeb9.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="96" id="k48zvk2C_Srb">
<div class="sourceCode" id="cb83"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply data augmentation to X_train_131, y_train_131, X_val_131, y_val_131</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>X_train_131, y_train_131, X_val_131, y_val_131 <span class="op">=</span> augment_data(X_train_131, y_train_131, X_val_131, y_val_131)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="97"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
id="MjriF4wI_cQZ" data-outputId="0b83651d-a6d6-4fb4-c267-5b7a30217c06">
<div class="sourceCode" id="cb84"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.set_random_seed(<span class="dv">42</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>X_train_131, y_train_131, X_val_131, y_val_131, num_classes_131 <span class="op">=</span> preprocess_data(X_train_131, y_train_131, X_val_131, y_val_131)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> create_cnn_model(input_shape_131, num_classes)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(X_train_131, y_train_131, validation_data<span class="op">=</span>(X_val_131, y_val_131),</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>                    epochs<span class="op">=</span><span class="dv">100</span>, batch_size<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>[earlyStopping])</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Final evaluation of the model</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> model.evaluate(X_val_131, y_val_131, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;CNN Error: </span><span class="sc">%.2f%%</span><span class="st">&quot;</span> <span class="op">%</span> (<span class="dv">100</span><span class="op">-</span>scores[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>plot_accuracy_loss(history)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
362/362 [==============================] - 169s 464ms/step - loss: 0.8025 - accuracy: 0.7538 - val_loss: 2.1564 - val_accuracy: 0.5663
Epoch 2/100
362/362 [==============================] - 167s 461ms/step - loss: 0.1422 - accuracy: 0.9634 - val_loss: 0.4610 - val_accuracy: 0.8630
Epoch 3/100
362/362 [==============================] - 165s 457ms/step - loss: 0.0342 - accuracy: 0.9945 - val_loss: 1.5055 - val_accuracy: 0.6863
Epoch 4/100
362/362 [==============================] - 167s 461ms/step - loss: 0.0254 - accuracy: 0.9956 - val_loss: 0.6406 - val_accuracy: 0.8283
Epoch 5/100
362/362 [==============================] - 169s 466ms/step - loss: 0.0063 - accuracy: 0.9994 - val_loss: 0.4583 - val_accuracy: 0.8723
Epoch 6/100
362/362 [==============================] - 169s 466ms/step - loss: 0.0027 - accuracy: 1.0000 - val_loss: 1.7590 - val_accuracy: 0.6230
Epoch 7/100
362/362 [==============================] - 167s 460ms/step - loss: 0.0715 - accuracy: 0.9783 - val_loss: 2.2870 - val_accuracy: 0.6390
Epoch 8/100
362/362 [==============================] - 166s 457ms/step - loss: 0.0290 - accuracy: 0.9928 - val_loss: 0.6767 - val_accuracy: 0.8310
Epoch 9/100
362/362 [==============================] - 167s 460ms/step - loss: 0.0056 - accuracy: 0.9991 - val_loss: 0.2001 - val_accuracy: 0.9417
Epoch 10/100
362/362 [==============================] - 167s 462ms/step - loss: 0.0016 - accuracy: 0.9999 - val_loss: 0.2298 - val_accuracy: 0.9363
Epoch 11/100
362/362 [==============================] - 169s 468ms/step - loss: 9.9355e-04 - accuracy: 1.0000 - val_loss: 0.1746 - val_accuracy: 0.9490
Epoch 12/100
362/362 [==============================] - 170s 469ms/step - loss: 5.4653e-04 - accuracy: 1.0000 - val_loss: 0.1814 - val_accuracy: 0.9543
Epoch 13/100
362/362 [==============================] - 170s 469ms/step - loss: 3.4118e-04 - accuracy: 1.0000 - val_loss: 0.1794 - val_accuracy: 0.9537
Epoch 14/100
362/362 [==============================] - 170s 471ms/step - loss: 2.4975e-04 - accuracy: 1.0000 - val_loss: 0.1711 - val_accuracy: 0.9527
Epoch 15/100
362/362 [==============================] - 169s 468ms/step - loss: 2.9959e-04 - accuracy: 1.0000 - val_loss: 0.1974 - val_accuracy: 0.9473
Epoch 16/100
362/362 [==============================] - 170s 470ms/step - loss: 2.2533e-04 - accuracy: 1.0000 - val_loss: 0.5393 - val_accuracy: 0.8640
Epoch 17/100
362/362 [==============================] - 172s 476ms/step - loss: 0.1083 - accuracy: 0.9662 - val_loss: 2.1155 - val_accuracy: 0.6460
Epoch 18/100
362/362 [==============================] - 172s 475ms/step - loss: 0.0168 - accuracy: 0.9953 - val_loss: 0.4169 - val_accuracy: 0.8920
Epoch 19/100
362/362 [==============================] - 173s 477ms/step - loss: 0.0082 - accuracy: 0.9978 - val_loss: 1.4205 - val_accuracy: 0.7620
CNN Error: 23.80%
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/03c95e3464e7365384fd8efe7e4d8c7384b54b8e.png" /></p>
</div>
</div>
<div class="cell markdown" id="tw4b9_OS_3Zx">
<p>best: post augment+oversample(37x37)=val_loss: 1.2488 - val_accuracy:
0.7493 <br> best: post augment(131x131)=val_loss: 1.6853 - val_accuracy:
0.7410</p>
</div>
<div class="cell code" data-execution_count="98" id="RnCc9jnbAlnz">
<div class="sourceCode" id="cb86"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>X_train_37 <span class="op">=</span> X_train_backup_37</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>y_train_37 <span class="op">=</span> y_train_backup_37</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>X_val_37 <span class="op">=</span> X_val_backup_37</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>y_val_37 <span class="op">=</span> y_val_backup_37</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>X_train_131 <span class="op">=</span> X_train_backup_131</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>y_train_131 <span class="op">=</span> y_train_backup_131</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>X_val_131 <span class="op">=</span> X_val_backup_131</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>y_val_131 <span class="op">=</span> y_val_backup_131</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="99" id="awO9PSRaBnbc">
<div class="sourceCode" id="cb87"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>X_train_37, y_train_37, X_val_37, y_val_37 <span class="op">=</span> augment_data(X_train_37, y_train_37, X_val_37, y_val_37)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>X_train_37, y_train_37 <span class="op">=</span> oversample_data(X_train_37, y_train_37)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply data augmentation to X_train_131, y_train_131, X_val_131, y_val_131</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>X_train_131, y_train_131, X_val_131, y_val_131 <span class="op">=</span> augment_data(X_train_131, y_train_131, X_val_131, y_val_131)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="100" id="4sKWx4vwB3m_">
<div class="sourceCode" id="cb88"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dropout</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_cnn_model(input_shape, num_classes):</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Sequential()</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(<span class="dv">32</span>, (<span class="dv">3</span>, <span class="dv">3</span>), input_shape<span class="op">=</span>input_shape, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>))</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    model.add(BatchNormalization())</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>    model.add(Dropout(<span class="fl">0.2</span>))  <span class="co"># Add dropout layer with 20% dropout rate</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    model.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(<span class="dv">64</span>, (<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>))</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>    model.add(BatchNormalization())</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>    model.add(Dropout(<span class="fl">0.2</span>))  <span class="co"># Add dropout layer with 20% dropout rate</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>    model.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(<span class="dv">64</span>, (<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>))</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>    model.add(BatchNormalization())</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>    model.add(Dropout(<span class="fl">0.2</span>))  <span class="co"># Add dropout layer with 20% dropout rate</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>    model.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>    model.add(Flatten())</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>    model.add(Dense(<span class="dv">128</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>))</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>    model.add(BatchNormalization())</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>    model.add(Dropout(<span class="fl">0.5</span>))  <span class="co"># Add dropout layer with 50% dropout rate</span></span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>    model.add(Dense(num_classes, activation<span class="op">=</span><span class="st">&#39;softmax&#39;</span>))</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">&#39;categorical_crossentropy&#39;</span>,</span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>                  optimizer<span class="op">=</span><span class="st">&#39;adam&#39;</span>,</span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>                  metrics<span class="op">=</span>[<span class="st">&#39;accuracy&#39;</span>])</span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="101"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
id="QT64OjJZB-2Y" data-outputId="a8e3c866-0150-40ee-bb71-62ca90cb8579">
<div class="sourceCode" id="cb89"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.set_random_seed(<span class="dv">42</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>X_train_37, y_train_37, X_val_37, y_val_37, num_classes_37 <span class="op">=</span> preprocess_data(X_train_37, y_train_37, X_val_37, y_val_37)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> create_cnn_model(input_shape_37, num_classes)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(X_train_37, y_train_37, validation_data<span class="op">=</span>(X_val_37, y_val_37),</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>                    epochs<span class="op">=</span><span class="dv">100</span>, batch_size<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>[earlyStopping])</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Final evaluation of the model</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> model.evaluate(X_val_37, y_val_37, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;CNN Error: </span><span class="sc">%.2f%%</span><span class="st">&quot;</span> <span class="op">%</span> (<span class="dv">100</span><span class="op">-</span>scores[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>plot_accuracy_loss(history)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
573/573 [==============================] - 21s 34ms/step - loss: 2.1719 - accuracy: 0.3315 - val_loss: 1.4247 - val_accuracy: 0.5263
Epoch 2/100
573/573 [==============================] - 19s 34ms/step - loss: 1.3204 - accuracy: 0.5695 - val_loss: 1.4099 - val_accuracy: 0.5437
Epoch 3/100
573/573 [==============================] - 19s 33ms/step - loss: 1.0258 - accuracy: 0.6675 - val_loss: 1.1614 - val_accuracy: 0.6620
Epoch 4/100
573/573 [==============================] - 19s 34ms/step - loss: 0.8438 - accuracy: 0.7263 - val_loss: 1.9922 - val_accuracy: 0.4813
Epoch 5/100
573/573 [==============================] - 19s 34ms/step - loss: 0.7204 - accuracy: 0.7674 - val_loss: 1.2946 - val_accuracy: 0.6243
Epoch 6/100
573/573 [==============================] - 19s 34ms/step - loss: 0.6413 - accuracy: 0.7916 - val_loss: 2.1957 - val_accuracy: 0.4720
Epoch 7/100
573/573 [==============================] - 19s 34ms/step - loss: 0.5748 - accuracy: 0.8140 - val_loss: 0.7476 - val_accuracy: 0.7640
Epoch 8/100
573/573 [==============================] - 19s 34ms/step - loss: 0.5190 - accuracy: 0.8302 - val_loss: 1.1516 - val_accuracy: 0.6800
Epoch 9/100
573/573 [==============================] - 19s 34ms/step - loss: 0.4881 - accuracy: 0.8398 - val_loss: 0.8268 - val_accuracy: 0.7537
Epoch 10/100
573/573 [==============================] - 19s 34ms/step - loss: 0.4530 - accuracy: 0.8536 - val_loss: 0.6803 - val_accuracy: 0.7893
Epoch 11/100
573/573 [==============================] - 19s 34ms/step - loss: 0.4314 - accuracy: 0.8598 - val_loss: 0.8019 - val_accuracy: 0.7687
Epoch 12/100
573/573 [==============================] - 19s 34ms/step - loss: 0.4043 - accuracy: 0.8682 - val_loss: 0.7408 - val_accuracy: 0.7817
Epoch 13/100
573/573 [==============================] - 19s 34ms/step - loss: 0.3815 - accuracy: 0.8750 - val_loss: 0.5066 - val_accuracy: 0.8443
Epoch 14/100
573/573 [==============================] - 19s 34ms/step - loss: 0.3684 - accuracy: 0.8797 - val_loss: 1.1897 - val_accuracy: 0.6773
Epoch 15/100
573/573 [==============================] - 19s 34ms/step - loss: 0.3532 - accuracy: 0.8836 - val_loss: 0.6973 - val_accuracy: 0.7963
Epoch 16/100
573/573 [==============================] - 19s 34ms/step - loss: 0.3383 - accuracy: 0.8899 - val_loss: 0.4638 - val_accuracy: 0.8610
Epoch 17/100
573/573 [==============================] - 19s 34ms/step - loss: 0.3294 - accuracy: 0.8918 - val_loss: 1.4344 - val_accuracy: 0.6530
Epoch 18/100
573/573 [==============================] - 19s 34ms/step - loss: 0.3161 - accuracy: 0.8962 - val_loss: 0.5605 - val_accuracy: 0.8317
Epoch 19/100
573/573 [==============================] - 19s 34ms/step - loss: 0.3047 - accuracy: 0.8997 - val_loss: 0.5205 - val_accuracy: 0.8453
Epoch 20/100
573/573 [==============================] - 19s 33ms/step - loss: 0.3027 - accuracy: 0.9008 - val_loss: 0.6171 - val_accuracy: 0.8103
Epoch 21/100
573/573 [==============================] - 19s 34ms/step - loss: 0.2976 - accuracy: 0.9005 - val_loss: 0.5695 - val_accuracy: 0.8320
CNN Error: 16.80%
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e0917674562e4461a60f615d5236b027/6dcf9a6b290b11e6dcf7e9de699d594bbcef16d8.png" /></p>
</div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="_hj5jNjvCH2V" data-outputId="2fdb2851-4eb3-4af8-b1d0-8ed30f90ae14">
<div class="sourceCode" id="cb91"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>tf.keras.utils.set_random_seed(<span class="dv">42</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>X_train_131, y_train_131, X_val_131, y_val_131, num_classes_131 <span class="op">=</span> preprocess_data(X_train_131, y_train_131, X_val_131, y_val_131)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> create_cnn_model(input_shape_131, num_classes)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(X_train_131, y_train_131, validation_data<span class="op">=</span>(X_val_131, y_val_131),</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>                    epochs<span class="op">=</span><span class="dv">100</span>, batch_size<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>[earlyStopping])</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Final evaluation of the model</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> model.evaluate(X_val_131, y_val_131, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;CNN Error: </span><span class="sc">%.2f%%</span><span class="st">&quot;</span> <span class="op">%</span> (<span class="dv">100</span><span class="op">-</span>scores[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>plot_accuracy_loss(history)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
325/362 [=========================&gt;....] - ETA: 19s - loss: 1.3806 - accuracy: 0.5766</code></pre>
</div>
</div>
</body>
</html>
